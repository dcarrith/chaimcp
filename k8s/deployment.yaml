apiVersion: apps/v1
kind: Deployment
metadata:
  name: chaimcp
  labels:
    app: chaimcp
spec:
  replicas: 1
  selector:
    matchLabels:
      app: chaimcp
  template:
    metadata:
      labels:
        app: chaimcp
    spec:
      containers:
        - name: chaimcp
          image: chaimcp:latest
          imagePullPolicy: Never
          ports:
            - containerPort: 8000
          envFrom:
            - configMapRef:
                name: chaimcp-config
          env:
            - name: MCP_AUTH_TOKEN
              valueFrom:
                secretKeyRef:
                  name: chaimcp-secrets
                  key: auth-token
            - name: CHIA_ROOT
              value: "/root/.chia/mainnet" # Internal path where we mount keys
            - name: MCP_TRANSPORT
              value: "http"
            - name: PYTHONUNBUFFERED
              value: "1"
            - name: MCP_PORT
              value: "8000"
            - name: SSL_KEY_FILE
              value: "/nonexistent"
            - name: SSL_CERT_FILE
              value: "/nonexistent"
            - name: MCP_DISABLED_TOOLS
              value: "generate_mnemonic,add_key,delete_key,delete_all_keys"

      # - name: chia-ssl
      #   mountPath: /root/.chia/mainnet/config/ssl
      #   readOnly: true
      # - name: chia-config
      #   mountPath: /root/.chia/mainnet/config/config.yaml
      #   subPath: config.yaml
      #   readOnly: true
      # volumes:
      # - name: chia-ssl
      #   hostPath:
      #     path: /Users/yourusername/.chia/mainnet/config/ssl # UPDATE THIS
      # - name: chia-config
      #   hostPath:
      #     path: /Users/yourusername/.chia/mainnet/config/config.yaml # UPDATE THIS
      # For local testing, sharing network namespace allows connecting to localhost:8555
      # hostNetwork: true
