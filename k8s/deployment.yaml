apiVersion: apps/v1
kind: Deployment
metadata:
  name: chiamcp
  labels:
    app: chiamcp
spec:
  replicas: 1
  selector:
    matchLabels:
      app: chiamcp
  template:
    metadata:
      labels:
        app: chiamcp
    spec:
      containers:
        - name: chiamcp
          image: chiamcp:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 8000
          env:
            - name: MCP_AUTH_TOKEN
              valueFrom:
                secretKeyRef:
                  name: chaimcp-secrets
                  key: auth-token
            - name: CHIA_ROOT
              value: "/root/.chia/mainnet" # Internal path where we mount keys
          volumeMounts:
            # User needs to mount their keys here.
            # This is an example assuming a Secret or HostPath
            - name: chia-ssl
              mountPath: /root/.chia/mainnet/config/ssl
              readOnly: true
            - name: chia-config
              mountPath: /root/.chia/mainnet/config/config.yaml
              subPath: config.yaml
              readOnly: true
      volumes:
        - name: chia-ssl
          hostPath:
            path: /Users/yourusername/.chia/mainnet/config/ssl # UPDATE THIS
        - name: chia-config
          hostPath:
            path: /Users/yourusername/.chia/mainnet/config/config.yaml # UPDATE THIS
      # For local testing, sharing network namespace allows connecting to localhost:8555
      # hostNetwork: true
